# RFC Annotations Tool

The RFC annotations tool allows a user to view a set of RFCs with relevant annotations.
Many annotations are automatically generated (such as which RFCs update the one being viewed),
but it is also easy to create your own annotations and share them with others.
The annotated RFCs are in HTML format with active links between the documents and to
other documents outside those generated by the tool.

__IMPORTANT NOTE__: This project is pre-release. We are encouraging new issues and
pull requests, and will incorporate changes as appropriate until approximately October 2022.
At that point, the project will have its first official release.
For now, consider this an alpha release where significant features and interfaces
may change before the final release.

This release of the RFC annotations tool is aimed at the RFCs that relate to the DNS.
All errata are shown in-line, and preliminary custom annotations include descriptions of
how each RFC is updated by others.
The primary intended audiences of this tool and the associated annotations are security researchers, DNS software developers,
and DNS protocol developers.

Although the automatically generated annotations will be useful to the intended audiences,
the expected value of the tool will be incorporating annotations from individuals.
Some examples of valuable annotations include:

- Errata placed in-line, possibly with commentary on the errata
- Notes of how an RFC is updated by other RFCs
- Instructions on how to configure open-source software to turn on protocol features
- Pointers to articles about security and/or operational issues with protocol features
- Links to mailing list discussions of interpretation of parts of RFCs

The generated RFCs are in HTML format with the annotations shown on the right side of the screen.
The files use standard CSS which can be modified locally to highlight particular types of
annotations or simply to suit the individual viewer's preferences.

(Special thanks go to the authors of [rfc2html](https://github.com/ietf-tools/rfc2html)
which is the basis of the HTMLization of RFCs in this tool.)

## Prerequisites

Running the tool to generate the annotated RFCs requires either [Docker](https://docker.com)
or the combination of `python3` (version 3.7 or greater) and `rsync`. `make` is mandatory if you
want to use the targets defined in the `Makefile`.

## Process Overview

The tool takes a list of target RFCs, reads the text version of the RFCs, and converts those RFCs to HTML.
The status of RFCs is fetched and turned into annotations that appear at the top of the generated RFCs.
The entire corpus of current Internet Drafts is also fetched or updated, and scanned for indications
that particular drafts intend to update or obsolete RFCs when they are eventually published as RFCs.
The complete list of errata is fetched or updated;
this is used for manual creation of annotations of the relevant errata.

The tool goes through all the annotations and incorporates them in the RFCs.
The last step in running the tool is to create the `index.html` file that has links to all the generated RFCs.

## Running the Tool

The list of RFCs is stored in the file `rfcs-to-use.txt`.
The tool comes with this file pre-populated with about 85 RFCs related to the DNS.
If you edit the file, you need to re-run the tool to download and generate the RFCs again.

The annotations are kept in the `annotations/` directory.
Annotations that are automatically generated by the tool are put in `annotations/_generated`;
it is unlikely that you want to touch that folder.
The tool goes through that directory and all subdirectories looking for files whose name
is "rfcnnnn.*" where "nnnn" matches one of the listed RFCs.
The file extension can be anything.
Any subdirectory of the `annotations/` directory that has a file called `.ignore` will be skipped
by the tool when adding annotations to the RFCs.
See the README in the `annotations/` folder for a description of the format of the annotation files.

The easiest way to run the tool is with `make`.

- `make clean` will remove all collected files and generated annotations (but not your own annotations).
- `make` and `make all` collect the text RFCs, Internet Drafts, status information, and errata, then generate the HTMLized RFCs.
- `make annotations` only refreshes the generated HTML by scanning the annotations directories
(`make annotations` does not create the `index.html` file).

The programs called by `make` (which are in `program/`) allow user configuration through environment variables.

- `RFC_TXT_DIR`, `RFC_OUTPUT` and `RFC_ANNOTATIONS` change the defaults of
`raw-originals/`, `generated-html/`, and `annotations/`, respectively,
- `RFC_LIST` can be used to act on a subset of RFCs.
The value is a space-separated list of numbers, such as "1035 2181".
This can be used to speed processing, but processing all RFCs on a typical laptop is
likely fast enough.
- `RFC_INDEX` tells the tool whether to create the `index.html` file.
Generating this file can sometimes be slow, so setting `RFC_INDEX=NO`
can speed up the overall building process.
- `RFC_INDEX_TEXT` if the `index.html` will be created this value will be used for injecting a html fragment on top of the page. 
It can be used as an extra explanation to the user describing the listed RFCs. 
The value of the environment variable overrides the contents derived from the
`rfcs-to-use.txt` file.
- `RFC_CSS` adds custom CSS to the HTMLized RFCs that are generated. See below.
- `RFC_HTML_WARNINGS` set to `"YES"` tells the annotation collector to display warnings about HTML
fix-ups that it is automatically applying.

## Viewing the Annotated RFCs

The generated HTML output, including the `index.html` file, are found in `generated-html/`.
The RFCs show annotations near the top that list the RFCs by which they are updated or obsoleted,
as well as an annotation with links to all the relevant errata.

Within annotations, links to RFCs that are in the set of generated RFCs lead to the generated
RFCs; links to other RFCs lead to the RFC Editor's site.

Annotations can be collapsed and expanded by clicking in the header line of the annotation.

Annotations are displayed with standard CSS. You can customize the CSS to change the way
that annotations are displayed as described below.

See the `annotations/README.md` file for instructions on how to create annotations.

## Personal CSS

The lines in the `RFC_CSS` environment variable are added to the end of the standards CSS,
meaning that you can both overwrite the current CSS entries and add your own.
If you add custom CSS, it is likely that you will do so in your shell's profile
file (`~/.bash_login`, `~/.profile`, and so on).

For example:
```
export RFC_CSS=$(cat <<EOF
.area .annotation .reported {display: block; background-color: #F88;}
.area .annotation .rejected {display: block; background-color: #F88;}
.area .annotation .updated {background-color: #88F;}
EOF
)
```
This would display rejected and reported errata on red background (whereas they are normally not shown),
and the status of "updated" show the annotations that have on a blue background.

You can also create CSS for individual document authors, such as:
```
.area .annotation .chris_smith {font-size: 1em; background-color: #00FC90;}
```

## Using Docker

If [Docker](https://www.docker.com/) is installed locally, you can run the tool
without any further prerequisites.
`make` encapsulates the commands for the build process for Docker using
targets `clean`, `docker-remove`, `docker-annotations` and `docker`.

